WEEK 3: ACTIVE DIRECTORY AND DOMAIN INTEGRATION

We will be adding a windows domain and adding our server to it. This will help us practice central identity management, user permissions, and hybrid administration (Windows + Linux).

SETTING UP WINDOWS SERVER VM
1. Get the ISO and Create the VM 
  a. Get a copy of windows 2022 iso from: https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2022
  b. Download virtualbox hypervisor
  c. Once vbox(virtual box) is installed, click new to create a VM
    - ISO should be the windows server we just installed. 
    - For the guest page, update credentials and hit next
    - Virtual hard ware should have: 4GB ram, 2 core CPU, min. 40GB of space

2. INSTALL THE WINDOWS SERVER
  a. Boot the VM 
  **CAUTION** WHEN STARTING THE VM YOU MAY GET A "windows cannot find the microsoft software license terms.." ERROR. GO TO > MACHINE > SETTINGS > STORAGE > FLOPPY > REMOVE DISK FROM VIRTUAL DRIVE
  b. English
  c. Edition: Windows Server 2022 Standard (Desktop Experience)
  d. Custom Install
    - hit Nect
  e. Wait for Install

3. SETUP
  a. Create admin credentials
  b. Login
  c. Let drivers update and finish
    -Windows Settings > Windows Update

4. Ensure connectivity between your ubuntu server and your Windows server by pinging.
  a. In windows VM type ipconfig to get your IP
  b. In ubuntu type ip a
  c. From each side ping each others IP to ensure they can talk to each other.

INSTALL AD DOMAIN SERVICES ON THE WINDOWS SERVER
1. Open windows server
  a.Click "Add Roles and Features"
  b.Select Role based of feature based installation
  c.Check Active Directory Domain Services and hit "Next"

2. After installation and a restart, click on the yellow flag in the server manager and check "Promote this server to a domain controller."
  a. Add a new forest
  b. Root domain name - lab.local
  C. Set a Directory Services Restore Mode (DSRM) password
  d. DNS Options → accept warnings
  e. Leave defaults for NetBIOS (should be LAB)
  f. Paths → default
  g. Click "install" after pre-requisite check

3. Verify Domain Controller Functionality
  a. Start → Server Manager → Tools → Active Directory Users and Computers
  b. In the left pane, expand your new domain lab.local
    - Name it Admin or Users
  c. Inside that OU:
    - Right-click → New → User
    - First name: Cloud
    - Last name: Admin  
    - User logon name: cloudadmin
    - Click Next, set a strong password, and check:
      x User cannot change password
      x Password never expires
    - Click Finish
  d. Now, make this new user a Domain Admin:
    - Right-click cloudadmin → Properties
    - Go to Member Of tab → click Add
    - Enter Domain Admins → OK
    - You should now see Domain Admins in the group list.
  e. Sign out and test your new account

JOIN THE UBUNTU SERVER TO THE DOMAIN
  1. Install AD Integration Packages
    a. sudo apt update
    b. sudo apt install realmd sssd sssd-tools libnss-sss libpam-sss adcli samba-common-bin oddjob oddjob-mkhomedir packagekit -y
  2. Set DNS on Ubuntu to Use Your Windows Server
    a. sudo nano /etc/systemd/resolved.conf
    b. Find: #DNS= and change it to DNS="Your Domain IP"
    c. Find: #Domains= and change it to: Domains=lab.local
    d. Restart DNS resolver:
      - sudo systemctl restart systemd-resolved
    e. test: resolvectl status
  3. Discover domain
    a. realm discover lab.local
  4. Join the Domain
    a. sudo realm join lab.local -U 'cloudadmin'
  5. Allow Domain Logins
    a. sudo realm permit --all
  6. Enable Home Directory Creation
    a. sudo pam-auth-update
    b. Use arrow keys to navigate, and space bar to select: Create home directory on login
  7. Test Domain Login
    a. ssh cloudadmin@lab.local 
    or
    b. su - cloudadmin@lab.local (Use this if you're already local)
  8. Verify
    a. id cloudadmin@lab.local










    
